<?php

namespace Bin\Controllers\Web;

use Bin\Models\Kelas;
use Snake\Core\Http\Request;
use Bin\Controllers\Controller;

class KelasController extends Controller {
  /**
   * Display a listing of the resource.
   *
   * @return void
   */
  public function index() {
    $classes = Kelas::all();
    $username = session()->get('user')['username'];

    static::view('pages.admin.kelas.index', [
      'data' => $classes,
      'username' => $username
    ]);
  }

  /**
   * Show the form for creating a new resource.
   *
   * @return void
   */
  public function create() {
    return static::view('pages.admin.kelas.create', [
      'bypass' => false
    ]);
  }

  /**
   * Store a newly created resource in storage.
   *
   * @return void
   */
  public function store() {
    $name = input('name');
    $description = input('description');

    if (empty($name)) return static::view('pages.admin.kelas.index', [
      'error' => 'Nama tidak boleh kosong'
    ]);

    if (empty($description)) return static::view('pages.admin.kelas.index', [
      'error' => 'Deskripsi tidak boleh kosong'
    ]);

    Kelas::query("insert into classes (name, description) values ('" . $name . "', '" . $description . "')");

    $bypass = session()->exists('user');

    if (!$bypass) return static::view('pages.admin.kelas.create', [
      'bypass' => true
    ]);

    return $this->index();
  }

  /**
   * Display specified resource.
   *
   * @return void
   */
  public function show(Request $request) {
    $id = $request->get("id");

    if (empty($id)) return static::view('pages.admin.kelas.index', [
      'error' => 'ID tidak boleh kosong'
    ]);

    $username = session()->get('user')['username'];
    $class = Kelas::query("select * from classes where id = " . $id)->fetch();

    static::view('pages.admin.kelas.show', [
      'data' => $class,
      'username' => $username
    ]);
  }

  /**
   * Update specified resource.
   *
   * @return void
   */
  public function update(Request $request) {
    $id = $request->get("id");

    // Get the input
    $name = input("name");
    $description = input("description");

    if (empty($id)) return static::view('pages.admin.kelas.index', [
      'error' => 'ID tidak boleh kosong'
    ]);

    if (empty($name) || empty($description)) {
      return static::view('pages.admin.kelas.index', [
        'error' => 'Nama dan deskripsi tidak boleh kosong'
      ]);
    }

    Kelas::query("update classes set name = '" . $name . "', description = '" . $description . "' where id = " . $id);

    return $this->index();
  }

  /**
   * Delete specified resource.
   *
   * @return void
   */
  public function destroy(Request $request) {
    $id = $request->get("id");

    if (empty($id)) return static::view('pages.admin.kelas.index', [
      'error' => 'ID tidak boleh kosong'
    ]);

    Kelas::query("delete from classes where id = " . $id);

    return $this->index();
  }
}
