<?= $this->extend('layouts.dashboard', ['title' => 'Catatan']) ?>

<?= $this->append('css') ?>
  <link rel="stylesheet" href="<?= asset('css/dashboard-custom.css') ?>">
<?= $this->stop() ?>

<?= $this->section('sidebar') ?>
  <?php if (session()->exists('user') && session()->get('user')['role'] == 'admin'): ?>
    <?= $this->put('partials.sidebar.admin') ?>
  <?php else: ?>
    <?= $this->put('partials.sidebar.user') ?>
  <?php endif; ?>
<?= $this->stop() ?>

<?= $this->section('content') ?>
  <?= $this->component('partials.header.hello', ['greet' => "Hello, " . $get('username')]) ?>
    <div>
      <a href="<?= route('admin.note.create') ?>" class="btn btn-primary">Tambah</a>
    </div>
  <?= $this->endcomponent() ?>

  <div class="container">
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Note</h5>
            <p class="card-text">Berikut adalah catatan kamu.</p>
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">Judul</th>
                  <th scope="col">Isi</th>
                  <th scope="col">Aksi</th>
                </tr>
              </thead>
              <tbody>
                <?php if (is_null($get('notes'))): ?>
                  <tr>
                    <td colspan="3" class="text-center">Data is empty</td>
                  </tr>
                <?php endif; ?>

                <?php if (!empty($get('notes'))): ?>
                  <?php foreach ($get('notes') as $key => $note): ?>
                    <tr>
                      <td><?= $note['title'] ?></td>
                      <td><?= $note['content'] ?></td>
                      <td>
                        <a href="<?= route('admin.note.edit') ?>?id=<?= $note['id'] ?>" class="btn btn-primary">Ubah</a>

                        <form action="<?= route('admin.note.index') ?>" method="get" class="d-inline">
                          <button type="submit" onclick="confirmDelete(<?= $note['id'] ?>)" class="btn btn-danger">Hapus</button>
                        </form>
                      </td>
                    </tr>
                  <?php endforeach; ?>
                <?php endif; ?>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
<?= $this->stop() ?>

<?= $this->append('script') ?>
  <script>
    function confirmDelete(id) {
      const confirm = window.confirm('Apakah anda yakin ingin menghapus data ini?');

      if (confirm) {
        fetch(`<?= route('admin.note.delete') ?>?id=${id}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        })
      }
    }
  </script>
<?= $this->stop() ?>
